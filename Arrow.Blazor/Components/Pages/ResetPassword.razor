@page "/reset-password"
@rendermode InteractiveServer

<PageTitle>Reset Password</PageTitle>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow">
                <div class="card-body">
                    <h3 class="card-title text-center mb-4">Reset Password</h3>

                    @if (_isLoading)
                    {
                        <div class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    }
                    else if (!_isValidToken)
                    {
                        <div class="alert alert-danger" role="alert">
                            <h5 class="alert-heading">Invalid or Expired Link</h5>
                            <p>This password reset link is invalid or has expired.</p>
                            <p class="mb-0">Please request a new password reset link.</p>
                        </div>
                        <div class="text-center mt-3">
                            <a href="/forgot-password" class="btn btn-outline-primary">Request New Link</a>
                        </div>
                    }
                    else if (!_passwordReset)
                    {
                        <EditForm Model="@_model" OnValidSubmit="HandleSubmit">
                            <DataAnnotationsValidator />

                            <div class="mb-3">
                                <label for="newPassword" class="form-label">New Password</label>
                                <InputText type="password" id="newPassword" @bind-Value="_model.NewPassword" class="form-control" placeholder="Enter new password" />
                                <ValidationMessage For="@(() => _model.NewPassword)" class="text-danger" />
                            </div>

                            <div class="mb-3">
                                <label for="confirmPassword" class="form-label">Confirm Password</label>
                                <InputText type="password" id="confirmPassword" @bind-Value="_model.ConfirmPassword" class="form-control" placeholder="Confirm new password" />
                                <ValidationMessage For="@(() => _model.ConfirmPassword)" class="text-danger" />
                            </div>

                            @if (!string.IsNullOrEmpty(_errorMessage))
                            {
                                <div class="alert alert-danger" role="alert">
                                    @_errorMessage
                                </div>
                            }

                            <button type="submit" class="btn btn-primary w-100" disabled="@_isSubmitting">
                                @if (_isSubmitting)
                                {
                                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                }
                                Reset Password
                            </button>
                        </EditForm>
                    }
                    else
                    {
                        <div class="alert alert-success" role="alert">
                            <h5 class="alert-heading">Success!</h5>
                            <p>Your password has been reset successfully.</p>
                            <p class="mb-0">You can now login with your new password.</p>
                        </div>
                        <div class="text-center mt-3">
                            <a href="/login" class="btn btn-primary">Go to Login</a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
